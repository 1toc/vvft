<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR視野測定 5×5グリッド</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <!-- カメラとコントローラー -->
        <a-entity id="rig" position="0 1.6 0">
            <a-entity id="camera" camera look-controls>
                <!-- 中心固視点(赤い点) - カメラに追随 -->
                <a-sphere position="0 0 -1" radius="0.02" color="#FF0000"></a-sphere>
            </a-entity>
            
            <!-- コントローラー(Quest対応) -->
            <a-entity oculus-touch-controls="hand: right"></a-entity>
            <a-entity oculus-touch-controls="hand: left"></a-entity>
        </a-entity>

        <!-- 背景 -->
        <a-sky color="#000000"></a-sky>

        <!-- 5×5グリッド(1-25) -->
        <a-entity id="gridContainer"></a-entity>
    </a-scene>

    <script>
        // グリッド設定
        const gridSize = 5; // 5×5
        const angleStep = 18; // 各数字間の角度(度)
        const distance = 3; // カメラからの距離(m)
        
        // 球面座標から直交座標への変換
        function sphericalToCartesian(horizontal, vertical, r) {
            const h = horizontal * Math.PI / 180;
            const v = vertical * Math.PI / 180;
            return {
                x: r * Math.sin(h) * Math.cos(v),
                y: r * Math.sin(v),
                z: -r * Math.cos(h) * Math.cos(v)
            };
        }

        // グリッド生成
        function createGrid() {
            const container = document.getElementById('gridContainer');
            const centerIndex = Math.floor(gridSize / 2); // 中心インデックス(2)
            let number = 1;

            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // 中心を0度として、相対的な角度を計算
                    const horizontalAngle = (col - centerIndex) * angleStep;
                    const verticalAngle = (centerIndex - row) * angleStep;
                    
                    // 位置を計算
                    const pos = sphericalToCartesian(horizontalAngle, verticalAngle, distance);
                    
                    // 数字エンティティを作成
                    const numberEntity = document.createElement('a-text');
                    numberEntity.setAttribute('value', number.toString());
                    numberEntity.setAttribute('position', `${pos.x} ${pos.y + 1.6} ${pos.z}`);
                    numberEntity.setAttribute('align', 'center');
                    numberEntity.setAttribute('color', '#FFFFFF');
                    numberEntity.setAttribute('width', '3'); // 大きめのフォント
                    numberEntity.setAttribute('look-at', '#camera'); // カメラの方を向く
                    
                    container.appendChild(numberEntity);
                    number++;
                }
            }
            
            console.log('5×5グリッド(1-25)を生成しました');
        }

        // 初期化
        window.addEventListener('load', function() {
            createGrid();
        });
    </script>
</body>
</html>
